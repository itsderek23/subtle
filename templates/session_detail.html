{% extends "base.html" %}

{% block title %}Session {{ session_id[:8] }}... - Subtle{% endblock %}

{% block content %}
<div x-data="sessionDetailApp('{{ session_id }}')">
    <div class="mb-6">
        <a href="/" class="text-white/40 hover:text-white/70 text-sm">&larr; Back to sessions</a>
        <h2 class="text-lg text-white/70 mt-2">
            Session <span class="text-white/50">{{ session_id[:8] }}...</span>
        </h2>
    </div>

    <div class="bg-white/[0.02] rounded-lg border border-white/10 overflow-hidden">
        <table class="w-full text-sm">
            <thead>
                <tr class="border-b border-white/10 text-white/50 text-left">
                    <th class="px-4 py-3 font-medium w-28">Type</th>
                    <th class="px-4 py-3 font-medium">Message</th>
                    <th class="px-4 py-3 font-medium w-24">Time</th>
                    <th class="px-4 py-3 font-medium w-20">Model</th>
                    <th class="px-4 py-3 font-medium w-20 text-right">Tokens</th>
                    <th class="px-4 py-3 font-medium w-32">Tools</th>
                </tr>
            </thead>
            <tbody>
                <template x-if="loading">
                    <tr>
                        <td colspan="6" class="px-4 py-8 text-center text-white/40">
                            Loading messages...
                        </td>
                    </tr>
                </template>
                <template x-if="!loading && messages.length === 0">
                    <tr>
                        <td colspan="6" class="px-4 py-8 text-center text-white/40">
                            No messages found
                        </td>
                    </tr>
                </template>
                <template x-for="message in messages" :key="message.index">
                    <tr class="border-b border-white/5 hover:bg-white/[0.02] cursor-pointer transition-colors"
                        @click="selectMessage(message.index)">
                        <td class="px-4 py-3">
                            <span :class="typeClass(message.type)" x-text="message.type"></span>
                        </td>
                        <td class="px-4 py-3 text-white/60 truncate max-w-md" x-text="message.preview || '–'"></td>
                        <td class="px-4 py-3 text-white/40" x-text="formatTime(message.timestamp)"></td>
                        <td class="px-4 py-3 text-white/40" x-text="formatModel(message.model)"></td>
                        <td class="px-4 py-3 text-right text-white/40">
                            <template x-if="message.input_tokens || message.output_tokens">
                                <span>
                                    <span x-text="message.input_tokens || 0"></span>
                                    <span class="text-white/20">/</span>
                                    <span x-text="message.output_tokens || 0"></span>
                                </span>
                            </template>
                            <template x-if="!message.input_tokens && !message.output_tokens">
                                <span>–</span>
                            </template>
                        </td>
                        <td class="px-4 py-3 text-white/40 truncate max-w-[8rem]" x-text="message.tools.join(', ') || '–'"></td>
                    </tr>
                </template>
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
